{% extends 'letters/base.html' %}
{% load i18n %}

{% block title %}{{ representative.full_name }} - WriteThem.eu{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <!-- Representative Summary -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0">{{ representative.full_name }}</h2>
            </div>
            <div class="card-body">
                {% include 'letters/partials/representative_card.html' with representative=representative constituency=representative.primary_constituency %}

                {% if representative.biography %}
                <div class="mt-3">
                    <h5>{% trans "√úber" %} {{ representative.full_name }}</h5>
                    <p class="mb-0">{{ representative.biography }}</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Committee Memberships -->
        {% if committee_memberships %}
        <div class="card mb-4">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">üìã {% trans "Committee Memberships" %}</h4>
                <span class="badge bg-light text-dark">{{ committee_memberships|length }}</span>
            </div>
            <div class="card-body">
                <div class="list-group">
                    {% for membership in committee_memberships %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between align-items-start">
                                <div class="me-3">
                                    <h6 class="mb-1">
                                        <a href="{% url 'committee_detail' membership.committee.pk %}">{{ membership.committee.name }}</a>
                                    </h6>
                                    <p class="mb-1 text-muted small">
                                        {{ membership.committee.parliament_term.parliament.name }} ¬∑ {{ membership.committee.parliament_term.name }}
                                    </p>
                                    {% if membership.committee.topic_areas.all %}
                                        <p class="mb-1 small">
                                            {% for topic in membership.committee.topic_areas.all %}
                                                <span class="badge bg-light text-dark border me-1">{{ topic.name }}</span>
                                            {% endfor %}
                                        </p>
                                    {% endif %}
                                    {% if membership.committee.keywords %}
                                        <p class="mb-0 small text-muted">{{ membership.committee.keywords }}</p>
                                    {% endif %}
                                </div>
                                <div class="text-end">
                                    <span class="badge {% if membership.role in 'chair,deputy_chair' %}bg-warning text-dark{% else %}bg-secondary{% endif %}">
                                        {{ membership.get_role_display }}
                                    </span>
                                    {% if membership.is_active %}
                                        <br><small class="text-success">{% trans "Active" %}</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Letters -->
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0">üìù {% trans "Open Letters" %} ({{ letters_to_rep.count }})</h4>
            </div>
            <div class="card-body">
                {% if letters_to_rep %}
                    {% for letter in letters_to_rep %}
                        {% include 'letters/partials/letter_card.html' %}
                    {% endfor %}
                {% else %}
                    <p class="text-muted mb-0">{% trans "No letters have been written to this representative yet." %}</p>
                    {% if user.is_authenticated %}
                    <a href="{% url 'letter_create' %}" class="btn btn-primary mt-3">{% trans "Write the First Letter" %}</a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card mb-4 sticky-top" style="top: 20px;">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">üîó {% trans "External Resources" %}</h5>
            </div>
            <div class="card-body">
                {% if abgeordnetenwatch_url %}
                <div class="mb-3">
                    <h6>{% trans "Abgeordnetenwatch Profile" %}</h6>
                    <p class="small text-muted mb-2">
                        {% trans "View voting record, questions, and detailed profile on Abgeordnetenwatch.de" %}
                    </p>
                    <a href="{{ abgeordnetenwatch_url }}" target="_blank" class="btn btn-primary btn-sm w-100">
                        {% trans "View on Abgeordnetenwatch" %} ‚Üí
                    </a>
                </div>
                {% endif %}

                {% if wikipedia_url %}
                <div class="mb-3">
                    <h6>{% trans "Wikipedia Article" %}</h6>
                    <p class="small text-muted mb-2">
                        {% trans "Read more about this representative on Wikipedia" %}
                    </p>
                    <a href="{{ wikipedia_url }}" target="_blank" class="btn btn-secondary btn-sm w-100">
                        {% trans "View on Wikipedia" %} ‚Üí
                    </a>
                </div>
                {% endif %}

                {% if not abgeordnetenwatch_url and not wikipedia_url %}
                <p class="text-muted small mb-3">{% trans "No external resources available for this representative." %}</p>
                {% endif %}

                <hr>

                {% if representative.contact_links %}
                <div class="mb-3">
                    <h6>{% trans "Kontakt" %}</h6>
                    <ul class="small mb-2">
                        {% for link in representative.contact_links %}
                            <li>
                                <a href="{{ link.url }}" target="_blank" rel="noopener">{{ link.label }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <hr>
                {% endif %}

                <div>
                    <h6>{% trans "Write a Letter" %}</h6>
                    <p class="small text-muted mb-2">
                        {% blocktrans with name=representative.full_name %}Start a new open letter to {{ name }}{% endblocktrans %}
                    </p>
                    {% if user.is_authenticated %}
                    <a href="{% url 'letter_create' %}?rep={{ representative.id }}" class="btn btn-success btn-sm w-100">
                        {% trans "Write Letter" %}
                    </a>
                    {% else %}
                    <a href="{% url 'login' %}?next={% url 'letter_create' %}?rep={{ representative.id }}" class="btn btn-success btn-sm w-100">
                        {% trans "Login to Write Letter" %}
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
